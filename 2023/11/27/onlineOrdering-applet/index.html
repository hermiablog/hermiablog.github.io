<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="onlineOrdering-applet, 技术博客">
    <meta name="description" content="个人技术博客">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>onlineOrdering-applet | hermia&#39;s blog</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery.min.js"></script>

<meta name="generator" content="Hexo 6.3.0"><link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head>



   <style>
    body{
       background-image: url(https://cdn.pixabay.com/photo/2012/04/14/16/37/sky-34536_1280.png);
       background-repeat:no-repeat;
       background-size:cover;
       background-attachment:fixed;
    }
</style>



<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">hermia&#39;s blog</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">hermia&#39;s blog</div>
        <div class="logo-desc">
            
            个人技术博客
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        
    </ul>
</div>


        </div>

        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/33.png')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">onlineOrdering-applet</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link
  rel="stylesheet"
  href="/libs/tocbot/tocbot.css"
/>
<style>
  #articleContent h1::before,
  #articleContent h2::before,
  #articleContent h3::before,
  #articleContent h4::before,
  #articleContent h5::before,
  #articleContent h6::before {
    display: block;
    content: " ";
    height: 100px;
    margin-top: -100px;
    visibility: hidden;
  }

  #articleContent :focus {
    outline: none;
  }

  .toc-fixed {
    position: fixed;
    top: 64px;
  }

  /* .toc-widget {
        width: 345px;
        padding-left: 20px;
    } */
  .toc-widget {
    width: 345px;
    padding-left: 20px;
    background-color: rgb(255, 255, 255, 0.7);
    border-radius: 10px;
    box-shadow: 0 10px 35px 2px rgba(0, 0, 0, 0.15),
      0 5px 15px rgba(0, 0, 0, 0.07), 0 2px 5px -5px rgba(0, 0, 0, 0.1) !important;
  }

  .toc-widget .toc-title {
    padding: 35px 0 15px 17px;
    font-size: 1.5rem;
    font-weight: bold;
    line-height: 1.5rem;
  }

  .toc-widget ol {
    padding: 0;
    list-style: none;
  }

  #toc-content {
    padding-bottom: 30px;
    overflow: auto;
  }

  #toc-content ol {
    padding-left: 10px;
  }

  #toc-content ol li {
    padding-left: 10px;
  }

  #toc-content .toc-link:hover {
    color: #a3ddf0;
    font-weight: 700;
    text-decoration: underline;
  }

  #toc-content .toc-link::before {
    background-color: transparent;
    max-height: 25px;

    position: absolute;
    right: 23.5vw;
    display: block;
  }

  #toc-content .is-active-link {
    color: #a3ddf0;
  }

  #floating-toc-btn {
    position: fixed;
    right: 15px;
    bottom: 76px;
    padding-top: 15px;
    margin-bottom: 0;
    z-index: 998;
  }

  #floating-toc-btn .btn-floating {
    width: 48px;
    height: 48px;
  }

  #floating-toc-btn .btn-floating i {
    line-height: 48px;
    font-size: 1.4rem;
  }
</style>
<div class="row">
  <div id="main-content" class="col s12 m12 l9">
    <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/applet/">
                                <span class="chip bg-color">applet</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/%E6%8A%80%E6%9C%AF/" class="post-category">
                                技术
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2023-11-27
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>更新日期:&nbsp;&nbsp;
                    2023-12-24
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    6.9k
                </div>
                

                

                
            </div>
        </div>
        <hr class="clearfix">

        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <span id="more"></span>
<p><a target="_blank" rel="noopener" href="https://github.com/hermiablog/onlineOrdering-applet">小程序链接</a></p>
<h2 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h2><img src="main.png" width="200">
<img src="menu.png" width="200">
<img src="cart.png" width="200">
<img src="order.png" width="200">
<img src="me.png" width="200">

<h2 id="项目创建过程"><a href="#项目创建过程" class="headerlink" title="项目创建过程"></a>项目创建过程</h2><h4 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h4><ol>
<li>将项目的通用样式写在<code>app.wxss</code>中<blockquote>
<ul>
<li>在根目录<code>page</code>下设置主题色、字号、字体颜色等</li>
<li>注意：<code>page</code>要设置<code>min-height=100%;</code>才会占满屏幕</li>
</ul>
</blockquote>
</li>
<li>清除常用组件的自带样式<blockquote>
<ul>
<li>将外边距、内边距都设置为0</li>
<li>将组件都设置为怪异盒模型</li>
</ul>
</blockquote>
</li>
<li>新建<code>src</code>文件夹，用于存放不可动态获取的图片、图标</li>
<li>新建<code>component</code>文件夹，用于存放自定义组件</li>
<li>自定义<code>icon</code>组件，实现<code>icon</code>图标的复用<blockquote>
<ul>
<li>新建<code>iconfont</code>文件夹，保存图标<code>wxss</code>文件</li>
<li>单独存放有利于随时替换</li>
</ul>
</blockquote>
</li>
</ol>
<pre><code>order-online
├─ .eslintrc.js
├─ app.js
├─ app.json
├─ app.wxss
├─ component
│  └─ icon
│     ├─ icon.js
│     ├─ icon.json
│     ├─ icon.wxml
│     └─ icon.wxss
├─ iconfont
│  └─ iconfont.wxss
├─ pages
│  └─ index
│     ├─ index.js
│     ├─ index.json
│     ├─ index.wxml
│     └─ index.wxss
├─ project.config.json
├─ project.private.config.json
├─ sitemap.json
├─ src
│  └─ icon
│     ├─ cart.png
│     ├─ index.png
│     ├─ menu.png
│     ├─ order.png
│     ├─ selected-cart.png
│     ├─ selected-index.png
│     ├─ selected-menu.png
│     ├─ selected-order.png
│     ├─ selected-user.png
│     ├─ takeBySelf.png
│     ├─ user.png
│     └─ waimai.png
└─ utils
   └─ util.js
</code></pre>
<h3 id="首页"><a href="#首页" class="headerlink" title="首页"></a>首页</h3><h4 id="基础准备"><a href="#基础准备" class="headerlink" title="基础准备"></a>基础准备</h4><ol>
<li>需要实现的效果</li>
</ol>
<ul>
<li>在顶部搜索框，输入产品名，可跳转到对应产品</li>
<li>选择取餐方式后，跳转到菜单页，并保存取餐方式</li>
<li>点击新品图片，可跳转到对应产品</li>
</ul>
<ol start="2">
<li>难点</li>
</ol>
<ul>
<li><p>顶部导航与胶囊按钮对齐</p>
<blockquote>
<ul>
<li>自定义导航<code>navigation</code></li>
<li>实现不同机型和开发工具的适配</li>
</ul>
</blockquote>
</li>
<li><p>搜索后跳转到对应产品&#x3D;&#x3D;(需补充)&#x3D;&#x3D;</p>
</li>
</ul>
<h4 id="第一步：实现tabBar"><a href="#第一步：实现tabBar" class="headerlink" title="第一步：实现tabBar"></a>第一步：实现<code>tabBar</code></h4><ol>
<li>根据项目需要，确认使用原生<code>tabBar</code></li>
<li>创建对应页面的文件</li>
<li>下载<code>tabBar</code>图标，存放至<code>src/icon</code>文件夹</li>
<li>在<code>app.json</code>里进行配置</li>
</ol>
<h4 id="第二步：自定义导航栏，并处理兼容性"><a href="#第二步：自定义导航栏，并处理兼容性" class="headerlink" title="第二步：自定义导航栏，并处理兼容性"></a>第二步：自定义导航栏，并处理兼容性</h4><blockquote>
<p>参考微信开发者社区回答：<a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/community/develop/article/doc/000aa842274d58cb15f74f81f56013">https://developers.weixin.qq.com/community/develop/article/doc/000aa842274d58cb15f74f81f56013</a></p>
<ul>
<li>新建<code>navigation-bar</code>组件构建自定义导航栏</li>
<li>菜单页引入该组件</li>
</ul>
</blockquote>
<p><strong><code>navigation-bar</code>组件内：</strong></p>
<blockquote>
<p><strong>实现对齐和适配的思路：</strong></p>
<ul>
<li>正常来讲，<code>iOS</code>和<code>Android</code>下的胶囊按钮的位置以及大小都是相同且不变的，我们可以通过胶囊按钮的位置和大小再配合 <code>wx.getSystemInfo</code> 或者 <code>wx.getSystemInfoSync</code> 中得到的 <code>statusBarHeight</code> 来计算出导航栏的位置和大小。</li>
<li>顶部导航区，包括状态栏、导航栏(导航条+胶囊)，都设置固定定位</li>
</ul>
</blockquote>
<blockquote>
<p><strong>实现步骤：</strong></p>
</blockquote>
<ol>
<li><p>首先需要知道不同<code>iOS</code>和<code>Android</code>下的胶囊按钮的位置以及大小</p>
<blockquote>
<ul>
<li>根据开发者的文档可知(非官方数据，自己进行微调)：</li>
</ul>
<pre><code>// iOS
  top 4px
  right 7px
  width 87px
  height 32px
// Android
  top 8px
  right 10px
  width 95px
  height 32px
// 开发者工具模拟器（iOS）
  top 6px
  right 10px
  width 87px
  height 32px
// 开发者工具模拟器（Android）
  top 8px
  right 10px
  width 87px
  height 32px
</code></pre>
<ul>
<li>这里<code>top</code>的值是从 <code>statusBarHeight</code> 作为原点开始计算的</li>
<li>因此最终位置还得加上状态栏的高度</li>
</ul>
</blockquote>
</li>
<li><p>通过<code>wx.getSystemInfoSync</code>可以得到状态栏<code>statusBarHeight</code>的位置和宽高</p>
<blockquote>
<ul>
<li>状态栏的宽度也就是可使用窗口宽度(手机屏幕宽度)</li>
</ul>
</blockquote>
</li>
<li><p>计算导航条的位置和大小</p>
<blockquote>
<ul>
<li>导航条要和胶囊平齐，所以：</li>
<li>top&#x3D;胶囊的top<blockquote>
<p>把胶囊离右边框的距离作为导航条的内边距</p>
</blockquote>
</li>
<li>left&#x3D;0</li>
<li>宽度&#x3D;可使用窗口宽度-胶囊右边距-胶囊宽度-导航条内边距&#x3D;可使用窗口宽度-胶囊宽度-胶囊右边距*3<blockquote>
<p>注意：胶囊的top是以状态栏为原点，但导航条是以屏幕左上角为原点</p>
</blockquote>
</li>
<li>height&#x3D;胶囊的height</li>
</ul>
</blockquote>
</li>
<li><p>计算整个导航栏(导航条+胶囊)的位置和大小</p>
<blockquote>
<ul>
<li>top&#x3D;状态栏的高度</li>
<li>left&#x3D;0</li>
<li>宽度&#x3D;可使用窗口宽度</li>
<li>高度&#x3D;<code>胶囊的height+胶囊的上外边距*2</code>&#x3D;<code>(胶囊的top-状态栏高度)*2+胶囊的height</code></li>
</ul>
</blockquote>
</li>
<li><p>格式化</p>
<blockquote>
<ul>
<li>前面的得到的所有数据都是对象的形式</li>
<li>而在页面上设置样式时，要在标签里用<code>style=&quot;&quot;</code>的方式</li>
<li>所以要把对象格式的数据，转为成字符串</li>
</ul>
<pre><code>formatStyle(position) &#123;
  //声明一个数组，存放遍历出来的数据，加px
  let styles = []
  for (let key in position) &#123;
 styles.push(`$&#123;key&#125;: $&#123;position[key]&#125;px;`)
  &#125;
  // 将数组转成字符串，把逗号替换成空格
  return styles.join(&#39; &#39;)
&#125;
</code></pre>
<ul>
<li>因为<code>wx.getSystemInfoSync()</code>得到的可使用窗口宽度，单位是px</li>
</ul>
</blockquote>
</li>
</ol>
<h4 id="第三步：搜索框"><a href="#第三步：搜索框" class="headerlink" title="第三步：搜索框"></a>第三步：搜索框</h4><ul>
<li>提高顶部导航区的层级，否则就会被<code>swiper</code>覆盖</li>
<li>搜索图标的显隐：在输入时，搜索图标自动消失</li>
<li>给输入框绑定<code>bind:input</code>事件，在<code>data</code>里设置一个变量<code>iconShow</code>来控制图标的显隐</li>
</ul>
<h4 id="第四步：顶部的swiper与底部banner区"><a href="#第四步：顶部的swiper与底部banner区" class="headerlink" title="第四步：顶部的swiper与底部banner区"></a>第四步：顶部的<code>swiper</code>与底部<code>banner</code>区</h4><blockquote>
<ul>
<li><code>swiper</code>使用<code>swiper</code>与<code>swiper-item</code>结合实现</li>
<li><code>banner</code>区的跳转&#x3D;&#x3D;(需补充)&#x3D;&#x3D;</li>
</ul>
</blockquote>
<h4 id="第五步-取餐方式跳转"><a href="#第五步-取餐方式跳转" class="headerlink" title="第五步 取餐方式跳转"></a>第五步 取餐方式跳转</h4><ol>
<li>思路<blockquote>
<ul>
<li>选择取餐方式之后进入菜单页面</li>
<li>菜单页面会根据点进来的方式，显示外卖还是自取，所以从首页跳转到菜单页必须<strong>携带参数</strong></li>
<li>根据之前学习过的声明式导航和编程式导航可知，这两种方式在跳转到<code>tabBar</code>页面时，不能携带参数</li>
</ul>
</blockquote>
</li>
</ol>
<blockquote>
<blockquote>
<p>解决方案：<br><a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/community/develop/article/doc/00000453df06f07a5c8d91ef856c13">参考回答</a></p>
</blockquote>
<ul>
<li>全局变量：通过<code>App</code>全局对象存放全局变量</li>
<li>数据缓存：通过存储到数据缓存中。</li>
<li>事件通信：通过事件通信通道。</li>
<li><code>wx.reLaunch(Object object)</code>，<code>url</code>路径后可以带参数，参数与路径之间使用<code>?</code>分隔</li>
</ul>
</blockquote>
<h4 id="数据动态化"><a href="#数据动态化" class="headerlink" title="数据动态化"></a>数据动态化</h4><img src="./src/首页获取数据.png">

<ol>
<li>单独配置发起网络请求的方法(全局可使用)</li>
</ol>
<ul>
<li><p>新建<code>config</code>文件</p>
<blockquote>
<ul>
<li>新建<code>api.js</code>文件，保存服务器接口根地址</li>
<li>新建<code>exception-message</code>文件，保存错误码字典</li>
</ul>
</blockquote>
</li>
<li><p>在<code>utils</code>文件夹中</p>
<blockquote>
<ul>
<li>新建<code>wxToPromise</code>文件，用于转换原生不支持<code>Promise</code>的官方<code>API</code></li>
<li>新建<code>http</code>文件<ul>
<li><code>request</code>方法：用于通过<code>wxToPromise</code>获得带有数据的<code>promise</code>对象，并进行错误信息比对</li>
<li><code>_showError</code>方法，如果发生请求错误，用于在页面展示错误信息</li>
</ul>
</li>
</ul>
</blockquote>
</li>
</ul>
<ol start="2">
<li>新建<code>model</code>文件夹<blockquote>
<ul>
<li>新建<code>Home</code>类，用于获取首页数据</li>
</ul>
</blockquote>
</li>
</ol>
<h3 id="菜单页"><a href="#菜单页" class="headerlink" title="菜单页"></a>菜单页</h3><h4 id="基础准备-1"><a href="#基础准备-1" class="headerlink" title="基础准备"></a>基础准备</h4><ol>
<li>需要实现的效果</li>
</ol>
<ul>
<li>获取离自己最近的店及距离(需要申请<code>wx.getLocation</code>接口)</li>
<li>点击左侧菜单栏，可获取对应分类的产品</li>
<li>点击产品，可选择产品规格、数量等</li>
<li>加入购物车后，其他页面的变化</li>
</ul>
<ol start="2">
<li>难点</li>
</ol>
<ul>
<li>左侧导航与右侧商品的关联</li>
<li>选品框：产品规格的选择、价格与数量联动、所选信息在其他页面上的使用</li>
</ul>
<blockquote>
<ul>
<li>取消整个页面的滚动条：在<code>json</code>中配置”disableScroll”: true&#96;</li>
</ul>
</blockquote>
<h4 id="数据动态化-1"><a href="#数据动态化-1" class="headerlink" title="数据动态化"></a>数据动态化</h4><ul>
<li>新建<code>Menu</code>模块，获取菜单页数据</li>
<li>其他与首页类似</li>
</ul>
<h4 id="页面布局"><a href="#页面布局" class="headerlink" title="页面布局"></a>页面布局</h4><ol>
<li>顶部</li>
</ol>
<ul>
<li>为了将它固定在顶部，不随页面滚动，使用粘性定位</li>
<li>右侧的取餐方式，根据参数选中，默认为外卖<blockquote>
<ul>
<li>创建变量<code>takeWayIndex</code>保存参数</li>
<li>在<code>onLoad</code>生命周期函数里通过<code>options</code>获取首页传来的参数</li>
<li>注意！：<strong>只有</strong>点击首页的选择框跳转，<code>options</code>才会获取参数，但，如果首次加载是直接点击<code>tabBar</code>到菜单页，那<code>options</code>就是一个空对象<code>&#123;&#125;</code></li>
<li>因此只在<code>options</code>不为空对象时，修改<code>takeWayIndex</code></li>
<li>要使用<code>(JSON.stringify(options) === &quot;&#123;&#125;&quot;)</code>进行判断；携带了参数时，<code>options</code>也是对象，所以不能通过数据类型判断</li>
</ul>
</blockquote>
</li>
</ul>
<ol start="2">
<li>下方商品列表</li>
</ol>
<ul>
<li>为了实现竖向滚动，左右都设为<code>scroll-view</code></li>
<li>左侧分类及右侧<code>banner</code>：动态获取数据，列表渲染</li>
<li>左侧选中状态：<blockquote>
<ul>
<li>创建一个变量<code>navLeftIndex</code>表示当前选中分类的索引，</li>
<li>绑定点击事件，使用自定义属性将当前被点击的分类下标传入，修改<code>navLeftIndex</code>；</li>
<li>只有当<code>navLeftIndex===index</code>时，被选中样式才会生效</li>
<li>为了不让选中标识影响文字，我给每个分类都设置了<code>divider </code>，选中时，只改变颜色</li>
</ul>
</blockquote>
</li>
</ul>
<ol start="3">
<li>右侧商品栏</li>
</ol>
<ul>
<li>顶部<code>banner</code></li>
<li>动态渲染商品列表</li>
</ul>
<ol start="4">
<li>如何点击左侧分类，右侧获取对应商品</li>
</ol>
<ul>
<li>定义变量<code>navLeftIndex</code>保存左侧被点击分类的索引</li>
<li>左侧被点击时，通过自定义属性修改<code>navLeftIndex</code>变量</li>
<li>右侧产品在进行列表渲染，根据<code>navLeftIndex</code>获取商品数据</li>
</ul>
<h4 id="选品页"><a href="#选品页" class="headerlink" title="选品页"></a>选品页</h4><ol>
<li><p>基础准备</p>
<blockquote>
<ul>
<li>新建组件<code>product-detail</code>，作为点击商品列表时打开的选品页</li>
<li>父页面：菜单页</li>
<li>需引入的子组件：图标组件<code>icon</code>、数量组件<code>cartNum</code><ul>
<li>数量组件也引用了图标组件<code>icon</code></li>
</ul>
</li>
</ul>
</blockquote>
</li>
<li><p>难点：</p>
<blockquote>
<ul>
<li>获取所点击的产品数据，并列表渲染嵌套了三层的数据</li>
<li>规格选择</li>
<li>金额与数量的联动，以及在其他页面的使用</li>
<li>商品加入购物车后，对其他页面的影响</li>
</ul>
</blockquote>
</li>
<li><p>本页面需要实现的效果及方法</p>
</li>
</ol>
<ul>
<li><p>选品页的打开与关闭</p>
<blockquote>
<ul>
<li>在父页面定义一个变量<code>detailFlag</code>，作为开关，默认为<code>true</code>；通过属性绑定将<code>detailFlag</code>传给组件</li>
<li>当父页面的产品发生点击事件时，将<code>detailFlag</code>修改为<code>false</code></li>
<li>组件的父容器<code>container</code>通过<code>hidden</code>属性来控制显隐</li>
<li>组件页面的关闭按钮，在被点击时，将<code>detailFlag</code>修改为<code>true</code></li>
</ul>
</blockquote>
</li>
<li><p>页面数据的动态化</p>
<blockquote>
<ul>
<li>在父页面的产品被点击时，保存该产品的<code>id</code></li>
<li>在<code>Menu</code>模块里，写一个静态方法，获取商品详情数据，保存在<code>detailInfo</code>变量里</li>
<li>通过属性绑定将该商品的数据传给组件，这样组件接收到的数据就是每次点击的商品数据了</li>
<li>使用<code>Mustache</code>语法将数据绑定到页面</li>
<li>注意产品规格的数据渲染，可定义<code>wx:for-item=&quot;&quot;</code>来区分子项：<ul>
<li>产品数据的<code>specs</code>里有三个规格</li>
<li>不同规格下有对应id和<code>specsDesc</code></li>
<li><code>specsDesc</code>放置的是不同的选择项及其<code>id</code></li>
</ul>
</li>
</ul>
</blockquote>
</li>
<li><p>商品规格的选择</p>
<blockquote>
<p>我踩过的坑</p>
<ul>
<li>一开始我选择的是<code>navLeftIndex===index</code>的方法，发现每个规格都会同时选中同一个选项</li>
</ul>
</blockquote>
</li>
</ul>
<blockquote>
<p>解决办法：<br><img src="./src/选品页.png"></p>
</blockquote>
<blockquote>
<ul>
<li>选中条件：选项的<code>isActive</code>为<code>true</code>；</li>
<li>而<code>isActive</code>在接口里已经定义了，也有默认选项；因此，需要改变页面所渲染的数据<code>detailInfo</code></li>
<li>如何改变？<ul>
<li>在点击规格选项时，将当前选项的id、当前规格的id、当前规格的所有数据都传到<code>js</code>里</li>
<li>在点击事件的事件处理函数里，for循环遍历当前规格的所有数据，先将所有选项的<code>isActive</code>改为<code>false</code>，再根据选项id，将该选项的<code>isActive</code>改为<code>true</code></li>
<li>遍历<code>detailInfo</code>，根据当前规格的id找到该规格下的数据，替换成前面修改过的；再将修改后的<code>detailInfo</code>更新到页面中</li>
</ul>
</li>
</ul>
</blockquote>
<ul>
<li>商品金额与数量的联动<blockquote>
<ul>
<li>数量的增减使用的是另一个组件</li>
</ul>
</blockquote>
</li>
</ul>
<blockquote>
<p>先分析下逻辑</p>
<ul>
<li>在产品点击后，数量默认为最小值1，此时选品框里的金额，就等于产品的单价</li>
<li>当数量增减时，金额等于单价*数量</li>
</ul>
</blockquote>
<blockquote>
<p>思路：</p>
<ul>
<li>数量组件需要通过事件绑定的方式将数量传给选品组件</li>
<li>选品组件定义一个变量<code>num</code>保存从子组件接收的值</li>
<li>选品组件定义一个变量<code>totalMoney</code>保存金额，默认为0，使用三元运算，当它为0时，页面使用接口里的值</li>
<li>和数量组件绑定的事件处理函数中，根据传来的<code>num</code>修改金额<blockquote>
<p>这样金额就和数量绑定在了一起，但存在以下问题：</p>
</blockquote>
</li>
</ul>
</blockquote>
<blockquote>
<p>问题：</p>
<ul>
<li>关闭选品框后，再打开另一产品，金额和数量不变</li>
</ul>
<p>解决方法：</p>
<ul>
<li>在关闭按钮的点击事件中，将金额重置为0，这样页面就会使用原始数据；将数量重置为最小值</li>
</ul>
</blockquote>
<ul>
<li>数量组件的优化<blockquote>
<p><strong>优化1：</strong>当数量达到边界值时，不再改变，且颜色变灰，表示不能再点击</p>
<ul>
<li>去掉图标组件的默认颜色，只声明类型(否则替换不了颜色，优先级太高)</li>
<li>父组件如何改变子组件的样式类？使用外部样式类<ul>
<li>在子组件中的<code>js</code>文件里用<code>externalClasses</code>定义外部样式类名，并写入对应标签的<code>class</code>中</li>
<li>父组件就可以直接在标签中用<code>外部样式类名=&quot;类名&quot;</code>的方式定义样式</li>
<li>当数量超过临界值时，就改变样式</li>
</ul>
</li>
</ul>
</blockquote>
</li>
</ul>
<blockquote>
<p><strong>优化2</strong>：点击事件的触发</p>
<ul>
<li>尝试1：使用<code>pointer-events: none;</code>发现无效，确认是小程序不支持该属性</li>
<li>尝试2：定义一个变量<code>isHandleClick</code>作为开关<ul>
<li>只在<code>isHandleClick</code>为<code>true</code>时才能点击</li>
<li>当<code>num</code>超过某一边的边界值时，<code>isHandleClick</code>变为<code>false</code>，不能再点击了，但！另一边的按钮也同时不能点击了</li>
</ul>
</li>
<li>尝试3：定义两个变量：<code>isAddClick</code>和<code>isMinClick</code><ul>
<li>这两个变量分别控制增加和减少按钮</li>
<li>和前面一样，当关闭选品页时，变量要重置，因此把这两个变量定义在选品组件里，通过属性绑定的方式传给数量组件</li>
<li>在增减按钮的点击事件函数中，根据临界值修改变量</li>
</ul>
</li>
</ul>
</blockquote>
<h4 id="Storage本地存储"><a href="#Storage本地存储" class="headerlink" title="Storage本地存储"></a>Storage本地存储</h4><ul>
<li><p>商品在选品时，加入购物车后，其他页面要显示对应的商品信息</p>
</li>
<li><p>因此需要将加入购物车的商品信息存在本地存储中</p>
</li>
<li><p>统一封装storage</p>
<blockquote>
<ul>
<li>在<code>utils</code>文件夹里，创建<code>storage.js</code>文件</li>
</ul>
</blockquote>
</li>
</ul>
<pre><code>/**
 * 微信小程序标准版：统一封装的 storage 操作类
 */
class Storage &#123;
  //类数组，通过[属性]的方式调用
  types = &#123;
    1: &#39;get&#39;, // get
    2: &#39;set&#39;, // set
    3: &#39;rm&#39; // rm
  &#125;
  /**
   * 检验本地存储 key 是否合法
   * @param &#123;String&#125; key | 要操作的键值
   * @param &#123;Number&#125; type | 类型，是 get set rm 
   * @param &#123;Boolean&#125; emptyFlag | 是否判断为空情况，默认判断 true，false 为不判断
   */
  checkKeyType(key, type, emptyFlag = true) &#123;
    if (typeof key != &#39;string&#39;) &#123;
      throw new Error(`Storage $&#123;this.types[type]&#125; func: key must be string`)
      return false
    &#125;
    if (emptyFlag) &#123;
      let tmpKey = key.TrimStr()
      if (tmpKey == &#39;&#39;) &#123;
        throw new Error(`Storage $&#123;this.types[type]&#125; func: key can not be empty`)
        return false
      &#125;
      return tmpKey;
    &#125;
    return key
  &#125;

  /**
   * get方法 从本地缓存中获取指定key的值
   * @param &#123;String&#125; key | 要操作的键值
   * @param &#123;Boolean&#125; syncFlag | 同步状态，默认 false (异步)，true 为同步
   */
  get = (key, syncFlag = false) =&gt; &#123;
    const tmpKey = this.checkKeyType(key, 1)
    if (tmpKey) &#123;
      const errMsg = &#39;Storage get: failed to get data&#39;
      return new Promise((resolve, reject) =&gt; &#123;
        if (syncFlag) &#123;
          let res = wx.getStorageSync(tmpKey)
          if (res) &#123;
            resolve(JSON.parse(res))
          &#125; else &#123;
            reject(errMsg)
          &#125;
        &#125; else &#123;
          wx.getStorage(&#123;
            key: tmpKey,
            success: (res) =&gt; &#123;
              resolve(JSON.parse(res.data))
            &#125;,
            fail: (err) =&gt; &#123;
              reject(errMsg)
            &#125;
          &#125;)
        &#125;
      &#125;)
    &#125;
  &#125;

  /**
   * 将数据保存在本地存储的指定key中 会覆盖掉原来该 key 对应的内容
   * @param &#123;String&#125; key | 要操作的键值
   * @param &#123;*&#125; data | 要存储的值，会转换为 JSON 串进行存储
   * @param &#123;Boolean&#125; syncFlag | 同步状态，默认 false (异步)，true 为同步
   */
  set = (key, data, syncFlag) =&gt; &#123;
    const tmpKey = this.checkKeyType(key, 2)
    if (tmpKey) &#123;
      const sucMsg = &#39;Storage set: set data successfully&#39;
      const errMsg = &#39;Storage set: failed to set data&#39;
      return new Promise((resolve, reject) =&gt; &#123;
        let tmpData = JSON.stringify(data)
        if (syncFlag) &#123;
          try &#123;
            wx.setStorageSync(tmpKey, tmpData)
            resolve(sucMsg)
          &#125; catch (err) &#123;
            console.log(err)
            reject(errMsg)
          &#125;
        &#125; else &#123;
          wx.setStorage(&#123;
            data: tmpData,
            key: tmpKey,
            success: () =&gt; &#123;
              resolve(sucMsg)
            &#125;,
            fail: (err) =&gt; &#123;
              console.log(err)
              reject(errMsg)
            &#125;
          &#125;)
        &#125;
      &#125;)
    &#125;
  &#125;

  /**
   * 可以移除本地存储中指定key的数据 如果不指定则清除全部数据
   * @param &#123;String&#125; key | 要操作的键值，为空则清空所有，有值则清空指定的值
   * @param &#123;Boolean*&#125; syncFlag | 同步状态，默认 false (异步)，true 为同步
   */
  rm = (key = &#39;&#39;, syncFlag = false) =&gt; &#123;
    let tmpKey = this.checkKeyType(key, 3, false)
    tmpKey = tmpKey.TrimStr()
    const sucMsg = &#39;Storage rm: rm data successfully&#39;
    const errMsg = &#39;Storage rm: failed to rm data&#39;
    return new Promise((resolve, reject) =&gt; &#123;
      if (tmpKey == &#39;&#39;) &#123;
        if (syncFlag) &#123;
          try &#123;
            wx.clearStorageSync()
            resolve(sucMsg)
          &#125; catch (err) &#123;
            console.log(err)
            reject(errMsg)
          &#125;
        &#125; else &#123;
          wx.clearStorage(&#123;
            success: (res) =&gt; &#123;
              resolve(sucMsg)
            &#125;,
            fail: (err) =&gt; &#123;
              console.log(err)
              reject(errMsg)
            &#125;
          &#125;)
        &#125;
      &#125; else &#123;
        if (syncFlag) &#123;
          try &#123;
            wx.removeStorageSync(tmpKey)
            resolve(sucMsg)
          &#125; catch (err) &#123;
            console.log(err)
            reject(errMsg)
          &#125;
        &#125; else &#123;
          wx.removeStorage(&#123;
            key: tmpKey,
            success: () =&gt; &#123;
              resolve(sucMsg)
            &#125;,
            fail: (err) =&gt; &#123;
              console.log(err)
              reject(errMsg)
            &#125;
          &#125;)
        &#125;
      &#125;
    &#125;)
  &#125;
&#125;
/**
 * 清除字符串前后的空格
 */
String.prototype.TrimStr = function () &#123;
  return this.replace(/(^\s*)|(\s*$)/g, &#39;&#39;);
&#125;

export &#123;
  Storage
&#125;
</code></pre>
<ul>
<li>使用：<blockquote>
<ul>
<li>在<code>app.js</code>顶部引入并注册 App 上</li>
</ul>
</blockquote>
</li>
</ul>
<pre><code>// app.js
import &#123; Storage &#125; from &#39;./utils/storage&#39;
const storage = new Storage();
App(&#123;
  storage,
  getStorage: storage.get,
  setStorage: storage.set,
  rmStorage: storage.rm,
...省略
&#125;)
</code></pre>
<blockquote>
<ul>
<li>在页面中使用</li>
</ul>
</blockquote>
<pre><code>// component/product-detail/product-detail.js
//获取应用实例
const app = getApp()
Component(&#123;
  //app打点的方式调用
&#125;)
</code></pre>
<h4 id="加入购物车-详情页"><a href="#加入购物车-详情页" class="headerlink" title="加入购物车(详情页)"></a>加入购物车(详情页)</h4><ol>
<li>实现效果</li>
</ol>
<ul>
<li>当用户选择商品数量，点击添加购物车后，能将该商品信息及选择数量保存在缓存中，使其他页面也能得到该数据</li>
<li>交互效果：弹出提示框，超过库存或添加成功</li>
<li>徽标：商品添加购物车后，购物车的tabBar部分会出现相应的数量</li>
</ul>
<ol start="2">
<li>难点</li>
</ol>
<ul>
<li>相同的<code>key</code>保存的数据会被覆盖</li>
<li>数量组件、选品页面、购物车页面之间的数据传递</li>
</ul>
<ol start="3">
<li>实现步骤</li>
</ol>
<ul>
<li><p>给<code>加入购物车按钮</code>添加点击事件</p>
</li>
<li><p>变量<code>selectNum</code>，用于保存当次选择的数量，即数量组件传过来的值</p>
</li>
<li><p>变量<code>numInCart</code>，用于当前产品已添加的总数</p>
<blockquote>
<ul>
<li>以上两个字段都要添加到<code>storage</code>里面，设置两个变量的目的在于：重复添加同一产品时，<code>numInCart</code>保存着上一次添加的数量，<code>selectNum</code>为本次添加的数量，需要相加后更新到<code>numInCart</code>中，作为总数</li>
</ul>
</blockquote>
</li>
<li><p>用<code>cartInfo</code>作为key值，在本地存储中保存购物数据</p>
</li>
<li><p>由于同一key的数据会被覆盖，而商品数据不止一条；因此，把商品数据都放入数组中，新数据<code>push</code>进数组</p>
</li>
<li><p>在更新<code>cartInfo</code>时，会遇到三种情况</p>
<blockquote>
<ul>
<li>第一种，第一次添加时，<code>storage</code>中没有<code>cartInfo</code>数据<ul>
<li>为<code>detailInfo</code>添加<code>numInCart</code>字段，表示添加商品的总数，就等于<code>selectNum</code></li>
<li>声明一个空数组，并将<code>detailInfo</code>存进数组</li>
<li>使用<code>setStorage</code>方法，将数组加入本地缓存</li>
</ul>
</li>
<li>第二种，<code>cartInfo</code>已经有该商品</li>
<li>第三种，<code>cartInfo</code>没有该商品</li>
</ul>
</blockquote>
</li>
<li><p>后面两种情况：</p>
<blockquote>
<ul>
<li>首先需要判断是否已经存过<ul>
<li>声明一个变量作为标志<code>isExist</code>，默认为<code>false</code>，表示缓存中没有该商品</li>
<li>获取缓存中的<code>cartInfo</code>，并进行遍历</li>
<li>将缓存中数据的id与当前商品的id进行对比，如果相等就将<code>isExist</code>修改为<code>true</code></li>
</ul>
</li>
<li><code>isExist</code>为<code>true</code>，存在同一产品：<ul>
<li>将两次添加的数量相加</li>
<li>判断库存，如果不超过库存，就添加进<code>storage</code>，超过了就提示</li>
</ul>
</li>
<li><code>isExist</code>为<code>false</code>，没存过：<ul>
<li>更新<code>numInCart</code></li>
<li>判断库存，如果不超过库存，就添加进<code>storage</code>，超过了就提示</li>
</ul>
</li>
</ul>
</blockquote>
</li>
</ul>
<ol start="4">
<li>购物车的徽标<br><strong>效果：</strong></li>
</ol>
<ul>
<li>初始化时，并没有徽标</li>
<li>商品加入购物车后，徽标显示当前添加的商品数量(不是杯数)</li>
</ul>
<p><strong>什么时候更新徽标数据</strong></p>
<ul>
<li>用户在关闭详情页时，此时已成功加入购物车</li>
<li>整个小程序在启动时，需要先获取本地存储中是否有数据<blockquote>
<ul>
<li>当数据存储在本地缓存中指定的key中，除非用户主动删除或因存储空间原因被系统清理，否则数据都一直可用</li>
</ul>
</blockquote>
</li>
<li>切换到购物车页面时，要获取最新数据</li>
</ul>
<h3 id="购物车页面"><a href="#购物车页面" class="headerlink" title="购物车页面"></a>购物车页面</h3><h4 id="基础准备-2"><a href="#基础准备-2" class="headerlink" title="基础准备"></a>基础准备</h4><ul>
<li>数据来源：本地缓存<code>storage</code></li>
<li>效果：<blockquote>
<ul>
<li>展示已选择商品的名称、价格、规格、数量等信息</li>
<li>商品结算时，金额与数量之间的联动、跳转到订单页结算</li>
<li>滑动删除商品</li>
</ul>
</blockquote>
</li>
<li>难点<blockquote>
<ul>
<li>单选&#x2F;全选商品时，总金额与数量之间的逻辑处理</li>
</ul>
</blockquote>
</li>
</ul>
<h4 id="购物车布局"><a href="#购物车布局" class="headerlink" title="购物车布局"></a>购物车布局</h4><ol>
<li>商品列表布局<blockquote>
<ul>
<li>拿到<code>storage</code>里的数据，遍历数据</li>
<li>规格需要三层遍历，分隔线<code>/</code>用伪元素做</li>
<li>选择按钮：给商品数据添加<code>selected</code>字段，用<code>wx:if</code>和<code>wx:else</code>控制显隐</li>
</ul>
</blockquote>
</li>
</ol>
<p><strong>细节：</strong></p>
<blockquote>
<ul>
<li>用户可以直接在购物车页面修改数量，因此需要保存修改后的值，更新页面</li>
<li>当页面隐藏&#x2F;切换时，要获取购物车页面的最新数据，并更新到<code>cartInfo</code>中</li>
</ul>
</blockquote>
<ol>
<li><p>空购物车界面</p>
<blockquote>
<ul>
<li>单独封装成自定义组件，实现复用</li>
</ul>
</blockquote>
</li>
<li><p>底部提交订单栏和滑动删除按钮</p>
</li>
</ol>
<p><strong>布局实现：使用<code>vant</code>组件</strong></p>
<blockquote>
<ul>
<li>初始化<code>npm -y</code></li>
<li>安装npm包：<code>npm i @vant/weapp -S --production</code></li>
<li>将 <code>app.json</code> 中的 <code>&quot;style&quot;: &quot;v2&quot;</code> 去除</li>
<li>打开微信开发者工具，点击 工具 -&gt; 构建<code>npm</code></li>
<li>在页面的<code>json</code>文件中引入组件</li>
</ul>
</blockquote>
<pre><code>&quot;usingComponents&quot;: &#123;
  &quot;van-swipe-cell&quot;: &quot;@vant/weapp/swipe-cell/index&quot;,
  &quot;van-submit-bar&quot;: &quot;@vant/weapp/submit-bar/index&quot;
&#125;
</code></pre>
<blockquote>
<ul>
<li>根据对应文档使用组件</li>
</ul>
</blockquote>
<p><strong>底部提交订单栏——js逻辑</strong></p>
<ul>
<li>效果<blockquote>
<ul>
<li>点击全选，可实现全选&#x2F;全不选购物车中所有商品</li>
<li>总金额会随选中的商品及其数量的变化而变化</li>
<li>结算的数量由<code>selected</code>字段决定</li>
</ul>
</blockquote>
</li>
<li>思路：<blockquote>
<p><strong>全选</strong></p>
<ul>
<li>声明一个变量<code>selectedAll</code>，作为全选的标识，默认为<code>false</code>，即没有全选</li>
<li>在全选按钮的点击事件中<ul>
<li>如果<code>selectedAll</code>为<code>false</code>，那就遍历购物车中所有商品，将<code>selected</code>字段都修改成<code>true</code>；修改完之后，再将<code>selectedAll</code>改为<code>true</code>，也就是已经<strong>全选</strong>了</li>
<li>在下一次点击时，看到<code>selectedAll</code>为<code>true</code>，就将购物车中所有商品的<code>selected</code>字段都修改成<code>false</code>，再将<code>selectedAll</code>改为<code>false</code>，这样就能实现<strong>全不选</strong></li>
<li>更新总金额和选择数量</li>
</ul>
</li>
</ul>
<p><strong>单选</strong></p>
<ul>
<li>拿到当前点击的商品数据，添加<code>selected</code>字段，并且值为相反值<br><code> cartInfo[index].selected = !cartInfo[index].selected</code><ul>
<li><code>selected</code>默认为<code>false</code>，这样既添加了新字段，又实现了两次点击的值相反</li>
<li>更新总金额和选择数量<br>细节：</li>
</ul>
</li>
<li>选中商品的数量为0时，结算按钮为灰色，不能点击；用三元运算符控制</li>
</ul>
</blockquote>
</li>
</ul>
<blockquote>
<p><strong>总金额和选择数量</strong></p>
<ul>
<li>由于单选或全选时都要更新总金额，因此单独定义一个方法<code>_updataMoney</code></li>
<li>声明一个变量<code>payMoney</code>，保存总金额</li>
<li>每次调用该方法，都会将<code>cartInfo</code>遍历一次，计算所有<code>selected</code>等于<code>true</code>的数据的 <strong>总金额和数量</strong></li>
<li>定义一个变量<code>isSelectedAll</code>，作为全选标志，默认为<code>true</code><ul>
<li>在遍历<code>cartInfo</code>时，任一商品的<code>selected</code>等于<code>false</code>，<code>isSelectedAll</code>就变成<code>false</code>，表示没有全选，因此将<code>selectedAll</code>修改为<code>false</code></li>
<li>在遍历完之后，如果<code>isSelectedAll</code>仍为<code>true</code>，就表示单选了购物车中所有商品，此时全选按钮应该亮起，因此将<code>selectedAll</code>修改为<code>true</code></li>
</ul>
</li>
<li>更新<code>cartInfo</code>和本地缓存</li>
</ul>
</blockquote>
<p><strong>滑动删除</strong></p>
<blockquote>
<ul>
<li>根据文档，使用<code>vant</code>组件进行布局</li>
<li>给删除按钮添加点击事件，用自定义属性传递索引</li>
<li>根据索引，找到当前点击的商品数据，把它从<code>cartInfo</code>数组中删除</li>
<li>调用方法更新总金额</li>
<li>更新缓存</li>
</ul>
</blockquote>
<p><strong>去结算</strong></p>
<blockquote>
<ul>
<li>声明一个空对象<code>acountData</code>保存要传递给订单页的数据</li>
<li>在结算按钮的点击事件中，将所有被选中的商品保存到一个空数组中</li>
<li>将总金额和结算数组保存到<code>acountData</code>对象中</li>
<li>将<code>acountData</code>作为新的<code>key</code>存入本地缓存，订单页可以通过该<code>key</code>获取数据</li>
<li>跳转到订单页</li>
</ul>
</blockquote>
<h3 id="订单页"><a href="#订单页" class="headerlink" title="订单页"></a>订单页</h3><p><strong>效果</strong></p>
<ul>
<li>滑动&#x2F;点击切换tabs标签可查看不同状态的订单</li>
<li>付款</li>
</ul>
<p><strong>难点</strong></p>
<ul>
<li>通过<code>WXS</code>和节流函数优化频繁划动切换带来的性能问题</li>
<li>支付成功后，删除购物车中的商品</li>
</ul>
<p><strong>布局</strong></p>
<ul>
<li>顶部分类栏</li>
<li>加入购物车的商品动态渲染</li>
<li>空订单时的界面：复用组件</li>
</ul>
<h4 id="实现tabs标签的切换"><a href="#实现tabs标签的切换" class="headerlink" title="实现tabs标签的切换"></a>实现tabs标签的切换</h4><ol>
<li>原理</li>
</ol>
<ul>
<li>在点击&#x2F;滑动事件中，将目标索引传入js中，保存在<code>currentTabIndex</code>中，当<code>tabs</code>标签的索引等于<code>currentTabIndex</code>时，激活选中样式</li>
<li>最重要的是传入目标索引，点击切换比较简单</li>
</ul>
<ol start="2">
<li><p>滑动切换<br><strong>思路</strong></p>
<blockquote>
<ul>
<li>在视图层<code>wxml、wxs</code>中处理<code>touchmove</code>事件，在处理完成之后，再将事件的结果传给逻辑层</li>
<li>控制灵敏度：计算手指触摸开始和结束的距离，当该距离在一定范围内时，再向逻辑层传递结果</li>
</ul>
</blockquote>
</li>
<li><p>节流优化</p>
</li>
</ol>
<ul>
<li>在接收滑动&#x2F;点击事件传来的<code>index</code>时，引入节流函数，控制执行频率</li>
</ul>
<h4 id="与购物车页面相关"><a href="#与购物车页面相关" class="headerlink" title="与购物车页面相关"></a>与购物车页面相关</h4><ol>
<li><p>点击结算之后删除商品</p>
<blockquote>
<ul>
<li>循环遍历加入本地缓存中的<code>acountList</code>数组，与<code>cartInfo</code>数据进行对比，删除相同数据，更新缓存和页面的<code>cartInfo</code></li>
</ul>
</blockquote>
</li>
<li><p><code>acountData</code>的调整</p>
<blockquote>
<ul>
<li>如果用户分几次结算商品，那么为了不覆盖前面的数据</li>
<li>应该先获取缓存中的商品数组和金额，然后将本次的商品<code>push</code>进去，计算总金额时也要加上前面的，最后更新缓存</li>
</ul>
</blockquote>
</li>
</ol>
<h3 id="个人中心"><a href="#个人中心" class="headerlink" title="个人中心"></a>个人中心</h3><ul>
<li><p>布局</p>
<blockquote>
<ul>
<li>创建两种状态的登录框</li>
<li>下方的列表在登录状态不同时，也应该不一样</li>
</ul>
</blockquote>
</li>
<li><p>开放能力</p>
<blockquote>
<ul>
<li>微信官方有在线客服和意见反馈的功能</li>
<li>将 <code>button</code> 组件 <code>open-type</code> 的值设置为 <code>contact</code>，当用户点击后就会进入客服会话</li>
<li>将 <code>button</code> 组件 <code>open-type</code> 的值设置为 <code>feedback</code>，当用户点击后就会打开“意见反馈”页面，用户可提交反馈内容并上传日志</li>
</ul>
</blockquote>
</li>
</ul>
<h4 id="授权登录——云开发"><a href="#授权登录——云开发" class="headerlink" title="授权登录——云开发"></a>授权登录——云开发</h4><p><strong>步骤：</strong></p>
<ul>
<li><p>使用<code>wx.getUserProfile</code>获取用户头像和昵称</p>
</li>
<li><p>创建云开发环境</p>
<blockquote>
<ul>
<li>在项目根目录 <code>project.config.json</code> 项目配置文件中，初始化配置云函数的文件夹的目录</li>
<li>在项目根目录中，新建 <code>cloud</code> 文件夹，并选择项目对应的环境</li>
</ul>
</blockquote>
</li>
<li><p>初始化</p>
<blockquote>
<ul>
<li>在云开发控制台中，创建数据表 <code>users</code> 用于存储用户信息</li>
<li>在 <code>cloud</code> 文件夹上右键 -&gt; 选择”新建 <code>Node.js</code> 云函数”，输入云函数名称 <code>login</code> 即可新建成功</li>
<li>在小程序 <code>app.js</code> 中初始化云函数</li>
<li>上传并部署云函数(每次修改云函数都要重新上传)</li>
<li>在微信端调用云函数，将<code>wx.getUserProfile</code>获取的用户头像和昵称等用户信息传给后端，用于生成用户账号</li>
</ul>
</blockquote>
</li>
<li><p>在<code>cloud/login/index.js</code>中编写根据<code>openId</code>查询用户信息的方法，根据查询返回的数组的长度来决定下一步是注册还是登录</p>
</li>
<li><p>注册用户账号</p>
<blockquote>
<ul>
<li>在 <code>cloud/login/index.js</code> 云函数中完成用户信息的注册，在数据库中新增用户数据</li>
<li>当用户注册成功后，根据 ID 快速查询当前用户的信息，并返回给前端</li>
<li>上传并部署云函数</li>
</ul>
</blockquote>
</li>
<li><p>实现登录逻辑</p>
<blockquote>
<ul>
<li>如果已经注册，就可以返回根据<code>openId</code>到的查询用户信息</li>
</ul>
</blockquote>
</li>
<li><p>小程序页面逻辑</p>
<blockquote>
<ul>
<li>获取登录后的数据，并将数据库中真实的用户信息同步到本地存储中，做数据的持久化</li>
<li>当页面切换时，实时获取最新的用户数据</li>
<li>注意：要在云开发控制台中，修改数据库的权限，选择所有用户可读</li>
</ul>
</blockquote>
</li>
</ul>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">hermia</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://hermiablog.com/2023/11/27/onlineOrdering-applet/">https://hermiablog.com/2023/11/27/onlineOrdering-applet/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">hermia</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/applet/">
                                    <span class="chip bg-color">applet</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="qq,qzone,wechat,weibo" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2023/11/29/CSS%E6%A0%B8%E5%BF%83%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%88%E4%B8%80%EF%BC%89/">
                    <div class="card-image">
                        
                        <img src="/medias/featureimages/4.jpg" class="responsive-img" alt="CSS核心知识点（一）">
                        
                        <span class="card-title">CSS核心知识点（一）</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            CSS核心知识点
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2023-11-29
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E6%8A%80%E6%9C%AF/" class="post-category">
                                    技术
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/CSS/">
                        <span class="chip bg-color">CSS</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2023/11/19/HTML%E5%8F%8Avscode/">
                    <div class="card-image">
                        
                        <img src="/medias/featureimages/2.jpg" class="responsive-img" alt="HTML及vscode">
                        
                        <span class="card-title">HTML及vscode</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            HTML标签及vscode配置
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2023-11-19
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E6%8A%80%E6%9C%AF/" class="post-category">
                                    技术
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/HTML/">
                        <span class="chip bg-color">HTML</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


  </div>
  <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
    <div class="toc-widget card" style="background-color: white">
      <div class="toc-title">
        <i class="far fa-list-alt"></i>&nbsp;&nbsp;目录
      </div>
      <div id="toc-content"></div>
    </div>
  </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
  <a class="btn-floating btn-large bg-color">
    <i class="fas fa-list-ul"></i>
  </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
  $(function () {
      tocbot.init({
          tocSelector: '#toc-content',
          contentSelector: '#articleContent',
          headingsOffset: -($(window).height() * 0.4 - 45),
          collapseDepth: Number('0'),
          headingSelector: 'h2, h3, h4'
      });

      // modify the toc link href to support Chinese.
      let i = 0;
      let tocHeading = 'toc-heading-';
      $('#toc-content a').each(function () {
          $(this).attr('href', '#' + tocHeading + (++i));
      });

      // modify the heading title id to support Chinese.
      i = 0;
      $('#articleContent').children('h2, h3, h4').each(function () {
          $(this).attr('id', tocHeading + (++i));
      });

      // Set scroll toc fixed.
      let tocHeight = parseInt($(window).height() * 0.4 - 64);
      let $tocWidget = $('.toc-widget');
      $(window).scroll(function () {
          let scroll = $(window).scrollTop();
          /* add post toc fixed. */
          if (scroll > tocHeight) {
              $tocWidget.addClass('toc-fixed');
          } else {
              $tocWidget.removeClass('toc-fixed');
          }
      });

      
      /* 修复文章卡片 div 的宽度. */
      let fixPostCardWidth = function (srcId, targetId) {
          let srcDiv = $('#' + srcId);
          if (srcDiv.length === 0) {
              return;
          }

          let w = srcDiv.width();
          if (w >= 450) {
              w = w + 21;
          } else if (w >= 350 && w < 450) {
              w = w + 18;
          } else if (w >= 300 && w < 350) {
              w = w + 16;
          } else {
              w = w + 14;
          }
          $('#' + targetId).width(w);
      };

      // 切换TOC目录展开收缩的相关操作.
      const expandedClass = 'expanded';
      let $tocAside = $('#toc-aside');
      let $mainContent = $('#main-content');
      $('#floating-toc-btn .btn-floating').click(function () {
          if ($tocAside.hasClass(expandedClass)) {
              $tocAside.removeClass(expandedClass).hide();
              $mainContent.removeClass('l9');
          } else {
              $tocAside.addClass(expandedClass).show();
              $mainContent.addClass('l9');
          }
          fixPostCardWidth('artDetail', 'prenext-posts');
      });
      
  });
</script>

    

</main>




    <footer class="page-footer bg-color">
   <link rel="stylesheet" href="/libs/aplayer/APlayer.min.css">
<style>
    .aplayer .aplayer-lrc p {
        
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }

    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        
        font-size: 15px;
        color: #a3ddf0;
        /* color: #59cde9; */
    }

    
    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
        left: -66px !important;
    }

    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
        left: 0px !important;
    }

    
</style>
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="netease"
                   type="playlist"
                   id="2450546498"
                   fixed='true'
                   autoplay='false'
                   theme='#59cde9'
                   loop='all'
                   order='random'
                   preload='auto'
                   volume='0.7'
                   list-folded='true'
        >
        </meting-js>
    </div>
</div>

<script src="/libs/aplayer/APlayer.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>
 
  <div
    class="container row center-align"
    style="margin-bottom: 15px !important;"
  >
    <div class="col s12 m8 l8 copy-right">
      Copyright&nbsp;&copy; 
      <span id="year"
        >2023-2024</span
      >
      
      <span id="year">2023</span>
      <a href="/about" target="_blank"
        >hermia</a
      >
      |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
      |&nbsp;Theme&nbsp;<a
        href="https://github.com/blinkfox/hexo-theme-matery"
        target="_blank"
        >Matery</a
      >
      <br />
           
      <span id="busuanzi_container_site_pv">
        |&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span
          id="busuanzi_value_site_pv"
          class="white-color"
        ></span
        >&nbsp;次
      </span>
       
      <span id="busuanzi_container_site_uv">
        |&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span
          id="busuanzi_value_site_uv"
          class="white-color"
        ></span
        >&nbsp;人
      </span>
      
      <br />
      
      <span id="sitetime">载入运行时间...</span>
      <script>
        function siteTime() {
          var seconds = 1000;
          var minutes = seconds * 60;
          var hours = minutes * 60;
          var days = hours * 24;
          var years = days * 365;
          var today = new Date();
          var startYear = "2023";
          var startMonth = "11";
          var startDate = "14";
          var startHour = "0";
          var startMinute = "0";
          var startSecond = "0";
          var todayYear = today.getFullYear();
          var todayMonth = today.getMonth() + 1;
          var todayDate = today.getDate();
          var todayHour = today.getHours();
          var todayMinute = today.getMinutes();
          var todaySecond = today.getSeconds();
          var t1 = Date.UTC(
            startYear,
            startMonth,
            startDate,
            startHour,
            startMinute,
            startSecond
          );
          var t2 = Date.UTC(
            todayYear,
            todayMonth,
            todayDate,
            todayHour,
            todayMinute,
            todaySecond
          );
          var diff = t2 - t1;
          var diffYears = Math.floor(diff / years);
          var diffDays = Math.floor(diff / days - diffYears * 365);
          var diffHours = Math.floor(
            (diff - (diffYears * 365 + diffDays) * days) / hours
          );
          var diffMinutes = Math.floor(
            (diff - (diffYears * 365 + diffDays) * days - diffHours * hours) /
              minutes
          );
          var diffSeconds = Math.floor(
            (diff -
              (diffYears * 365 + diffDays) * days -
              diffHours * hours -
              diffMinutes * minutes) /
              seconds
          );
          if (startYear == todayYear) {
            document.getElementById("year").innerHTML = todayYear;
            document.getElementById("sitetime").innerHTML =
              "本站已安全运行 " +
              diffDays +
              " 天 " +
              diffHours +
              " 小时 " +
              diffMinutes +
              " 分钟 " +
              diffSeconds +
              " 秒";
          } else {
            document.getElementById("year").innerHTML =
              startYear + " - " + todayYear;
            document.getElementById("sitetime").innerHTML =
              "本站已安全运行 " +
              diffYears +
              " 年 " +
              diffDays +
              " 天 " +
              diffHours +
              " 小时 " +
              diffMinutes +
              " 分钟 " +
              diffSeconds +
              " 秒";
          }
        }
        setInterval(siteTime, 1000);
      </script>
      
      <br />
      
    </div>
    <div class="col s12 m4 l4 social-link social-statis">
      
<a
  href="https://github.com/hermiablog/hermiablog.github.io"
  class="tooltipped"
  target="_blank"
  data-tooltip="访问我的GitHub"
  data-position="top"
  data-delay="50"
>
  <i class="fab fa-github"></i>
</a>
 
<a
  href="mailto:1587837237@qq.com"
  class="tooltipped"
  target="_blank"
  data-tooltip="邮件联系我"
  data-position="top"
  data-delay="50"
>
  <i class="fas fa-envelope-open"></i>
</a>
<!-- 
   
<a
  href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=1587837237"
  class="tooltipped"
  target="_blank"
  data-tooltip="QQ联系我: 1587837237"
  data-position="top"
  data-delay="50"
>
  <i class="fab fa-qq"></i>
</a>
    -->

    </div>
  </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

	
    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
